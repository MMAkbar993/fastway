<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FASTWAY - Playoff</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/style standing Copie.css" />
    <link rel="stylesheet" href="css/modern-styles.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="images/favicon_io/site.webmanifest">
    <style>
        .playoff-page {
            max-width: 1400px;
            margin: 50px auto;
            padding: 0 40px;
        }

        .standings-preview table tbody tr:hover {
            background: rgba(255, 255, 255, 0.95) !important;
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .playoff-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .playoff-header h1 {
            font-size: 42px;
            font-weight: 900;
            color: #1a1a1a;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .playoff-status {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(250, 250, 252, 0.9) 100%);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .playoff-status h2 {
            color: #1a1a1a;
            font-size: 24px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .playoff-status p {
            color: #2a2a2a;
            font-size: 18px;
            margin: 8px 0;
        }

        .playoff-status .active {
            color: #00e7ff;
            font-weight: bold;
        }

        .playoff-bracket {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .bracket-section {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .bracket-section h3 {
            color: #1a1a1a;
            font-size: 20px;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            border-bottom: 2px solid rgba(0, 231, 255, 0.3);
            padding-bottom: 10px;
        }

        .bracket-series {
            margin-bottom: 30px;
        }

        .bracket-series h4 {
            color: #ff003c;
            font-size: 16px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .qualified-driver {
            background: rgba(255, 255, 255, 0.8);
            border-left: 4px solid #ff003c;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            color: #1a1a1a;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .qualified-driver:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .qualified-driver.eliminated {
            opacity: 0.4;
            filter: grayscale(100%);
            border-left-color: #666;
        }

        .driver-stats {
            font-size: 14px;
            color: #2a2a2a;
        }

        .playoff-rounds {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .round-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(250, 250, 252, 0.9) 100%);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .round-card h3 {
            color: #1a1a1a;
            font-size: 22px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .round-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff003c, #00e7ff);
            transition: width 0.3s ease;
        }

        .no-playoff {
            text-align: center;
            padding: 60px 20px;
            color: #2a2a2a;
        }

        .no-playoff h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        .no-playoff p {
            font-size: 18px;
            line-height: 1.6;
            color: #2a2a2a;
        }

        .final-battle {
            background: linear-gradient(135deg, #ff003c 0%, #0077ff 100%);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 0, 60, 0.5);
        }

        .final-battle h2 {
            color: #fff;
            font-size: 32px;
            margin-bottom: 20px;
            text-transform: uppercase;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .final-contenders {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .contender {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            min-width: 200px;
        }

        .contender h3 {
            color: #fff;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .contender .name {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <header>
        <div class="navbar">
            <a href="index.html" class="logo">
                <div class="logo-container">
                    <img src="images/Fastwaylogo2 (1).png" alt="FASTWAY Logo">
                </div>
            </a>
            <nav class="nav-links">
                <a href="index.html">STANDING</a>
                <a href="playoff.html" style="color: #00e7ff;">PLAYOFF</a>
                <a href="driverlist.html">DRIVER LIST</a>
                <a href="halloffame.html">HALL OF FAME</a>
                <a href="award.html">AWARD</a>
            </nav>
        </div>
        <div class="navbar-underline"></div>
    </header>

    <main class="playoff-page">
        <div class="playoff-header">
            <h1>FASTWAY Playoffs</h1>
        </div>

        <div id="playoffContent">
            <!-- Content will be dynamically generated -->
        </div>
    </main>

    <script>
        // Playoff configuration (matching index.html)
        const PLAYOFF_STRUCTURE = [
            { name: "ROUND 1", races: 3, targetCount: 10 },
            { name: "ROUND 2", races: 3, targetCount: 6 },
            { name: "ROUND 3", races: 2, targetCount: 2 },
            { name: "DIVISION FINAL", races: 5, targetCount: 1 }
        ];

        // Load playoff state
        function loadPlayoffState() {
            try {
                const saved = localStorage.getItem('fastway_playoff_state');
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Error loading playoff state:', e);
            }
            return {
                active: false,
                currentRoundIndex: 0,
                currentRaceInRound: 0,
                isFinal: false
            };
        }

        function loadPlayoffData() {
            try {
                const saved = localStorage.getItem('fastway_playoff_data');
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Error loading playoff data:', e);
            }
            return {
                A: { qualified: [] },
                B: { qualified: [] }
            };
        }

        function loadDriverData() {
            try {
                const allData = JSON.parse(localStorage.getItem('fastwayAllData') || '[]');
                const raceState = JSON.parse(localStorage.getItem('fastway_race_state_v2') || '{}');
                
                const drivers = {};
                allData.forEach(driver => {
                    drivers[driver.name] = {
                        points: parseInt(driver.points) || 0,
                        wins: parseInt(driver.wins) || 0,
                        chWins: parseInt(driver.chWins) || 0,
                        bestTime: driver.bestTime || '--',
                        total: (parseInt(driver.wins) || 0) * 10 + (parseInt(driver.points) || 0)
                    };
                });

                // Merge with race state stats
                if (raceState.A && raceState.A.carStats) {
                    Object.entries(raceState.A.carStats).forEach(([name, stats]) => {
                        if (!drivers[name]) drivers[name] = {};
                        drivers[name].wins = stats.wins || drivers[name].wins || 0;
                    });
                }
                if (raceState.B && raceState.B.carStats) {
                    Object.entries(raceState.B.carStats).forEach(([name, stats]) => {
                        if (!drivers[name]) drivers[name] = {};
                        drivers[name].wins = stats.wins || drivers[name].wins || 0;
                    });
                }

                return drivers;
            } catch (e) {
                console.warn('Error loading driver data:', e);
                return {};
            }
        }

        function loadStandingData() {
            try {
                const allData = JSON.parse(localStorage.getItem('fastwayAllData') || '[]');
                const raceState = JSON.parse(localStorage.getItem('fastway_race_state_v2') || '{}');
                
                const standings = [];
                allData.forEach(driver => {
                    const statsA = raceState.A?.carStats?.[driver.name] || {};
                    const statsB = raceState.B?.carStats?.[driver.name] || {};
                    const combinedWins = (statsA.wins || 0) + (statsB.wins || 0);
                    
                    standings.push({
                        name: driver.name,
                        points: parseInt(driver.points) || 0,
                        wins: parseInt(driver.wins) || 0,
                        chWins: parseInt(driver.chWins) || 0,
                        bestTime: driver.bestTime || '--',
                        total: (parseInt(driver.wins) || 0) * 10 + (parseInt(driver.points) || 0)
                    });
                });
                
                // Sort: Cars with chWins first (most to least), then by total points
                standings.sort((a, b) => {
                    if (a.chWins > 0 && b.chWins === 0) return -1;
                    if (a.chWins === 0 && b.chWins > 0) return 1;
                    if (a.chWins > 0 && b.chWins > 0) return b.chWins - a.chWins;
                    return b.total - a.total;
                });
                
                return standings;
            } catch (e) {
                console.warn('Error loading standing data:', e);
                return [];
            }
        }

        function renderPlayoffPage() {
            const playoffState = loadPlayoffState();
            const playoffData = loadPlayoffData();
            const driverData = loadDriverData();
            const standings = loadStandingData();
            const content = document.getElementById('playoffContent');

            if (!playoffState.active) {
                // Check for tie between 14th and 15th position
                const hasTie = standings.length > 14 && 
                               standings[13].chWins === standings[14].chWins && 
                               standings[13].total === standings[14].total;
                
                // Show standing table even when playoffs not started
                let html = '<div class="standings-preview">';
                html += '<h2 style="color: #1a1a1a; text-align: center; margin-bottom: 30px; font-size: 32px; font-weight: 900;">Current Standings</h2>';
                html += '<div style="max-width: 1000px; margin: 0 auto;">';
                html += '<div style="background: rgba(255, 255, 255, 0.9); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 16px;">';
                html += '<thead><tr style="background: linear-gradient(135deg, rgba(0, 231, 255, 0.15) 0%, rgba(255, 0, 60, 0.15) 100%); border-bottom: 2px solid rgba(0, 0, 0, 0.1);">';
                html += '<th style="padding: 15px 12px; text-align: left; font-weight: 800; color: #1a1a1a; width: 80px;">Pos</th>';
                html += '<th style="padding: 15px 12px; text-align: left; font-weight: 800; color: #1a1a1a;">Car</th>';
                html += '<th style="padding: 15px 12px; text-align: center; font-weight: 800; color: #1a1a1a; width: 120px;">CH Wins</th>';
                html += '<th style="padding: 15px 12px; text-align: center; font-weight: 800; color: #1a1a1a; width: 120px;">Total</th>';
                html += '</tr></thead><tbody>';
                
                standings.forEach((car, index) => {
                    const isQualified = index < 14;
                    const hasChWin = car.chWins > 0;
                    // Red line between 14th and 15th (border-top on index 14, which is position 15)
                    const rowStyle = index === 14 ? 'border-top: 4px solid #ff003c;' : '';
                    const bgColor = hasChWin ? 'rgba(255, 215, 0, 0.15)' : (isQualified ? 'rgba(255, 255, 255, 0.7)' : 'rgba(255, 255, 255, 0.5)');
                    
                    html += `<tr style="${rowStyle} background: ${bgColor}; transition: all 0.2s ease;">`;
                    html += `<td style="padding: 12px; font-weight: 700; color: #1a1a1a;">${index + 1}</td>`;
                    html += `<td style="padding: 12px; font-weight: 600; color: #1a1a1a;">${car.name}</td>`;
                    html += `<td style="padding: 12px; text-align: center; color: #FFD700; font-weight: 700;">${car.chWins}</td>`;
                    html += `<td style="padding: 12px; text-align: center; color: #1a1a1a; font-weight: 600;">${car.total}</td>`;
                    html += `</tr>`;
                    
                    // Show tie message between 14th and 15th if there's a tie
                    if (index === 13 && hasTie) {
                        html += '<tr style="border-top: 4px solid #ff003c; background: rgba(255, 0, 60, 0.1);">';
                        html += '<td colspan="4" style="padding: 15px; text-align: center;">';
                        html += '<div style="color: #ff003c; font-weight: 800; font-size: 18px; margin-bottom: 8px;">TIED</div>';
                        html += '<div style="color: #1a1a1a; font-size: 14px;">A race is required to decide who enters the playoffs</div>';
                        html += '</td></tr>';
                    }
                });
                
                html += '</tbody></table></div></div></div>';
                html += `
                    <div class="no-playoff" style="margin-top: 40px;">
                        <h2>Playoffs Not Started</h2>
                        <p>The playoffs will begin automatically after the regular season is complete.</p>
                        <p>Complete all regular season races to unlock the playoff bracket.</p>
                    </div>
                `;
                content.innerHTML = html;
                return;
            }

            let html = '';

            // Check for tie between 14th and 15th position
            const hasTie = standings.length > 14 && 
                           standings[13].chWins === standings[14].chWins && 
                           standings[13].total === standings[14].total;

            // Standing table preview
            html += '<div class="standings-preview" style="margin-bottom: 40px;">';
            html += '<h2 style="color: #1a1a1a; text-align: center; margin-bottom: 30px; font-size: 32px; font-weight: 900;">Current Standings</h2>';
            html += '<div style="max-width: 1000px; margin: 0 auto;">';
            html += '<div style="background: rgba(255, 255, 255, 0.9); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">';
            html += '<table style="width: 100%; border-collapse: collapse; font-size: 16px;">';
            html += '<thead><tr style="background: linear-gradient(135deg, rgba(0, 231, 255, 0.15) 0%, rgba(255, 0, 60, 0.15) 100%); border-bottom: 2px solid rgba(0, 0, 0, 0.1);">';
            html += '<th style="padding: 15px 12px; text-align: left; font-weight: 800; color: #1a1a1a; width: 80px;">Pos</th>';
            html += '<th style="padding: 15px 12px; text-align: left; font-weight: 800; color: #1a1a1a;">Car</th>';
            html += '<th style="padding: 15px 12px; text-align: center; font-weight: 800; color: #1a1a1a; width: 120px;">CH Wins</th>';
            html += '<th style="padding: 15px 12px; text-align: center; font-weight: 800; color: #1a1a1a; width: 120px;">Total</th>';
            html += '</tr></thead><tbody>';
            
            standings.forEach((car, index) => {
                const isQualified = index < 14;
                const hasChWin = car.chWins > 0;
                // Red line between 14th and 15th (border-top on index 14, which is position 15)
                const rowStyle = index === 14 ? 'border-top: 4px solid #ff003c;' : '';
                const bgColor = hasChWin ? 'rgba(255, 215, 0, 0.15)' : (isQualified ? 'rgba(255, 255, 255, 0.7)' : 'rgba(255, 255, 255, 0.5)');
                
                html += `<tr style="${rowStyle} background: ${bgColor}; transition: all 0.2s ease;">`;
                html += `<td style="padding: 12px; font-weight: 700; color: #1a1a1a;">${index + 1}</td>`;
                html += `<td style="padding: 12px; font-weight: 600; color: #1a1a1a;">${car.name}</td>`;
                html += `<td style="padding: 12px; text-align: center; color: #FFD700; font-weight: 700;">${car.chWins}</td>`;
                html += `<td style="padding: 12px; text-align: center; color: #1a1a1a; font-weight: 600;">${car.total}</td>`;
                html += `</tr>`;
                
                // Show tie message between 14th and 15th if there's a tie
                if (index === 13 && hasTie) {
                    html += '<tr style="border-top: 4px solid #ff003c; background: rgba(255, 0, 60, 0.1);">';
                    html += '<td colspan="4" style="padding: 15px; text-align: center;">';
                    html += '<div style="color: #ff003c; font-weight: 800; font-size: 18px; margin-bottom: 8px;">TIED</div>';
                    html += '<div style="color: #1a1a1a; font-size: 14px;">A race is required to decide who enters the playoffs</div>';
                    html += '</td></tr>';
                }
            });
            
            html += '</tbody></table></div></div></div>';

            // Status section
            const currentRound = PLAYOFF_STRUCTURE[playoffState.currentRoundIndex];
            html += `
                <div class="playoff-status">
                    <h2>Current Status</h2>
                    <p><span class="active">Active Round:</span> ${currentRound ? currentRound.name : 'N/A'}</p>
                    <p>Race ${playoffState.currentRaceInRound + 1} / ${currentRound ? currentRound.races : 0}</p>
                    ${playoffState.isFinal ? '<p class="active">FASTWAY FINAL - Best of 7</p>' : ''}
                </div>
            `;

            // Final battle section
            if (playoffState.isFinal) {
                const winnerA = playoffData.A.qualified[0] || 'TBD';
                const winnerB = playoffData.B.qualified[0] || 'TBD';
                html += `
                    <div class="final-battle">
                        <h2>üèÅ FASTWAY FINAL üèÅ</h2>
                        <div class="final-contenders">
                            <div class="contender">
                                <h3>S√©rie A Champion</h3>
                                <div class="name">${winnerA}</div>
                            </div>
                            <div class="contender">
                                <h3>S√©rie B Champion</h3>
                                <div class="name">${winnerB}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Bracket sections
            html += '<div class="playoff-bracket">';

            // Series A
            html += `
                <div class="bracket-section">
                    <h3>S√©rie A</h3>
                    <div class="bracket-series">
                        <h4>Qualified Drivers (${playoffData.A.qualified.length})</h4>
                        ${renderQualifiedDrivers(playoffData.A.qualified, driverData, 'A')}
                    </div>
                </div>
            `;

            // Series B
            html += `
                <div class="bracket-section">
                    <h3>S√©rie B</h3>
                    <div class="bracket-series">
                        <h4>Qualified Drivers (${playoffData.B.qualified.length})</h4>
                        ${renderQualifiedDrivers(playoffData.B.qualified, driverData, 'B')}
                    </div>
                </div>
            `;

            html += '</div>';

            // Round progress
            html += '<div class="playoff-rounds">';
            PLAYOFF_STRUCTURE.forEach((round, index) => {
                const isActive = index === playoffState.currentRoundIndex;
                const isCompleted = index < playoffState.currentRoundIndex;
                const progress = isActive ? ((playoffState.currentRaceInRound / round.races) * 100) : (isCompleted ? 100 : 0);
                
                html += `
                    <div class="round-card ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}">
                        <h3>${round.name}</h3>
                        <p>Races: ${round.races} | Target: ${round.targetCount} drivers per series</p>
                        <div class="round-progress">
                            <span style="color: #00e7ff;">Progress</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <span style="color: #00e7ff;">${Math.round(progress)}%</span>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            content.innerHTML = html;
        }

        function renderQualifiedDrivers(qualified, driverData, series) {
            if (qualified.length === 0) {
                return '<p style="color: #888; padding: 20px; text-align: center;">No drivers qualified yet</p>';
            }

            return qualified.map((name, index) => {
                const driver = driverData[name] || {};
                const total = driver.total || 0;
                const wins = driver.wins || 0;
                const chWins = driver.chWins || 0;
                
                return `
                    <div class="qualified-driver">
                        <div>
                            <strong>#${index + 1}</strong> ${name}
                        </div>
                        <div class="driver-stats">
                            Total: ${total} | Wins: ${wins} | CH: ${chWins}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            renderPlayoffPage();
            // Refresh every 5 seconds to show updates
            setInterval(renderPlayoffPage, 5000);
        });
    </script>
</body>

</html>

